@*@{
        Layout = null;
    }*@

@model MaquinaDeTrocos.Models.novasMoedas


<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Gerar Troco</title>
</head>
<body style="margin-top: 100px">

    @using (Html.BeginForm("calcularTroco", "MaquinaDeTroco", FormMethod.Post, new
    {
        id = "formularioTroco"
    }))
    {
        <div class="row text-center col-lg-12 col-lg-offset-2">
            <input type="number" id="recebido" class="col-lg-4" name="recebido" value="ValorPago" placeholder="Valor Pago" />
            <input type="number" id="produtos" class="col-lg-4" name="produtos" value="valorTotal" placeholder="Preço Produto" />
            <button type="submit" id="gerarTroco" class="col-lg-8">Gerar Troco</button>
        </div>
    }


    @*<input type="number" id="recebido" name="recebido" value="ValorPago" placeholder="Valor Pago" />
        <input type="number" id="produtos" name="produtos" value="valorTotal" placeholder="Preço Produto" />
        <button type="submit" id="gerarTroco">Gerar Troco</button>*@


    <div class="modal fade" id="modalCarregar" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <img src="../Content/Imgs/tenor.gif" />
                <h1>Carregando...</h1>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalCarregado" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <h1 id="texto-modal">Deu certo!</h1>
            </div>
        </div>
    </div>

    <div class="container-estado text-center col-lg-12" style="display: none;">
        <h1 id="h1-texto" style="">Estado atual da máquina</h1>
        @for (int i = 0; i < Model.moedasList.Count; i++)
        {
            <div id="@Model.moedasList[i].valor" style="display: none;">

                <img id="imagem-troco" src="@Url.Content(Model.moedasList[i].srcIgm)" />
                <span class="@Model.moedasList[i].valor"></span>
            </div>
        }


    </div>




    @Scripts.Render("~/bundles/jquery", "~/bundles/bootstrap")



    <script type="text/javascript">

        $('#formularioTroco').on('submit', function (e) {
            e.preventDefault();
            $('#modalCarregar').modal('show');

            $.ajax({
                url: "/MaquinaDeTroco/calcularTroco",
                data: $(this).serialize(),
                dataType: "json",
                method: "POST",
                cache: false,
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (resp) {
                    if (resp.mensagem == "S") {

                        console.log("Deu certo!");
                        setTimeout(() => {
                            $('#modalCarregar').modal('hide')
                        }, 2000);
                        setTimeout(() => {
                            $('#modalCarregado').modal('show')
                        }, 2050);
                        $(".container-estado").css("display", "block")
                        $("#h1-texto").css("display", "block")
                        for (let i = 0; i < resp.valores.length; i++) {
                            if (resp.valores[i].quantidade > 0) {
                                $("#" + resp.valores[i].valor).css("display", "block");
                                $("." + resp.valores[i].valor).text("Retirar do caixa " + resp.valores[i].quantidade + " moedas de " + resp.valores[i].valor + " centavos");
                            }
                        }
                    } else {
                        $('#modalCarregar').modal('hide');
                        $('#texto-modal').text(resp.erro);
                        $('#modalCarregado').modal('show');
                        
                    }
                },
                error: function (erro) {

                    console.log("Deu errado :(")
                    
                }
            });

        });








    </script>
</body>
</html>
